!function(e,n){"function"==typeof define?define.amd?define(function(){return n()}):define.cmd&&define(function(e,o,i){i.exports=n()}):"object"==typeof module&&"object"==typeof module.exports?module.exports=n():e.QunarAPI=n()}("undefined"!=typeof window?window:this,function(){"use strict";function e(e){return"function"==typeof e}function n(e){return"[object String]"===Object.prototype.toString.call(e)}function o(e,n){for(var o in e)c.register(o,e[o],n)}function i(){p.length>0&&(p.forEach(function(e){c.invoke(e.key,e.callback,e.param)}),p=[])}function t(e){d.length>0&&d.forEach(function(n){n(e)})}function a(){if(m.wechat){var n=u.getElementsByTagName("head")[0],o=u.createElement("script");o.setAttribute("src",f.wechatApiUrl),n.appendChild(o),o.onload=function(){for(var e in wx)c[e]=wx[e];c.onMenuShare=function(e){for(var n in y.share.wechat)c[n](e)},c.isReady=!0,p.forEach(function(e){c[e.key](e.param)}),p=[]}}else m.qunar&&(c.hy.onInitData=function(n){c.hy.getInitData({success:function(o){e(n.success)&&n.success(o)}})},window.addEventListener("load",function(){setTimeout(function(){c.bridge||t({ret:!1,errcode:-1,errmsg:"bridge注入失败"})},600)}))}function r(n,o,i){if(!o)return void console.error("Parameters are not allowed to be empty!");b[i]&&(o=b[i](o));var t=o.success,a=o.fail,r=o.complete,s=function(u){l.debug&&console.log(u);var h=Array.prototype.slice.call(arguments,0);u&&"undefined"!=typeof u.ret?u.ret?(h[0]=u.data,e(t)&&t.apply(null,h),v.api[i]&&v.api[i].call(o,u.data||{})):e(a)&&a.apply(null,h):(e(t)&&t.apply(null,h),v.api[i]&&v.api[i].call(o,u||{})),e(r)&&r.apply(null,h),m.qunar&&-1!=u.errcode&&v.bridge.method(i)&&c.invoke(n,s,o,i)};c.invoke(n,s,o,i)}var c={},s=window,u=s.document,h=s.navigator.userAgent,l={},p=[],d=[],f={wechatApiUrl:"http://res.wx.qq.com/open/js/jweixin-1.0.0.js"},w={},g={},m=function(){return/MicroMessenger/i.test(h)?{wechat:!0,version:""}:/Qunar/i.test(h)?{qunar:!0,version:""}:{h5:!0,version:""}}(),v={api:{openWebView:function(){e(this.onViewBack)&&c.hy.onceReceiveData({success:this.onViewBack})}},bridge:{method:function(e){return y.share.wechat[e]||y.share.hy[e]?"invoke":""}}},b={checkJsApi:function(n){var o=w,i=n.success,t=n.jsApiList.slice(0);return n.jsApiList=t.map(function(e){return o[e]||e}),n.success=function(n){var a={};t.forEach(function(e){var i=o[e];a[e]=n[i]||!1}),e(i)&&i.call(null,a)},n},log:function(e){if(n(e)){var o={message:e};return o}return e}},y={common:{chooseImage:"chooseImage",previewImage:"previewImage",uploadImage:"uploadImage",downloadImage:"downloadImage",getNetworkType:"network.getType",openLocation:"openLocation",getLocation:"geolocation.getCurrentPosition",closeWindow:"webview.back",hideOptionMenu:"hideOptionMenu",showOptionMenu:"showOptionMenu",hideMenuItems:"hideMenuItems",showMenuItems:"showMenuItems",hideAllNonBaseMenuItem:"hideAllNonBaseMenuItem",showAllNonBaseMenuItem:"showAllNonBaseMenuItem",hideLoadView:"webview.hideLoadView",scanQRCode:"scanQRCode",checkJsApi:"checkJsApi"},share:{wechat:{onMenuShareTimeline:"onMenuShareTimeline",onMenuShareAppMessage:"onMenuShareAppMessage"},hy:{onMenuShareWeiboApp:"onMenuShareWeiboApp",onMenuShareSMS:"onMenuShareSMS",onMenuShareEmail:"onMenuShareEmail",onMenuShare:"onMenuShare",onMenuShareQunarIM:"onMenuShareQunarIM"}},hy:{openWebView:"webview.open",closeWebView:"webview.back",setWebViewAttr:"webview.attribute",getInitData:"webview.getInitData",onShow:"webview.onShow",onHide:"webview.onHide",onReceiveData:"webview.onReceiveData",onceReceiveData:"webview.onReceiveData",onCloseWebView:"webview.targetClosed",onceCloseWebView:"webview.targetClosed",onBeforeShow:"webview.onBeforeShow",onBeforeHide:"webview.onBeforeHide",onDestroy:"webview.onDestroy",navRefresh:"navigation.refresh",onNavClick:"navigation.click",shareTimeline:"shareTimeline",shareAppMessage:"sendAppMessage",shareWeiboApp:"shareWeiboApp",shareSMS:"shareSMS",shareEmail:"shareEmail",shareQunarIM:"shareQunarIM",shareImageToTimeline:"shareImageToTimeline",showShareItems:"doShare",getDeviceInfo:"native.getDeviceInfo",login:"login.start",syncLoginFromTouch:"syncLoginFromTouch",log:"debug.log",uelog:"hy.uelog"},h5:{getLocation:function(e,n){navigator.geolocation?navigator.geolocation.getCurrentPosition(n.success,n.fail,{enableHighAccuracy:n.enableHighAccuracy||!0,timeout:n.timeout||5e3}):e({ret:!1,errcode:-1,errmsg:"Geolocation is not supported!"})},login:function(e,n){var o,i,t,a="";i="http://user.qunar.com/mobile/login.jsp",o={ret:n.ret||encodeURIComponent(location.href),goback:n.goback||"",backUrl:n.backUrl||""};for(t in o)o.hasOwnProperty(t)&&""!==o[t]&&(a+=t+"="+o[t]);location.href=i+"?"+a},checkJsApi:function(e,n){var o,i=n.jsApiList||[],t={};i.forEach(function(e){o=g[e],t[e]=!!y.h5[o]}),e(t)},notSupport:function(n,o,i,t){e(n)&&n({ret:!1,errcode:-1,errmsg:'浏览器环境下不支持"'+t+'"接口调用'})}}};return c={version:"1.0.10",isReady:!1,bridge:null,sniff:m,ready:function(n){var o=this;m.qunar?u.addEventListener("WebViewJavascriptBridgeReady",function(t){o.isReady=!0,o.bridge=t.bridge,e(n)&&n.call(o),i()}):m.h5&&(o.isReady=!0,e(n)&&n.call(o))},config:function(e){r("config",l=e)},error:function(n){e(n)&&d.push(n)},invoke:function(n,o,i,t){if(e(o))if(c.isReady)if(m.qunar){t=t||n;var a="invoke";0===t.indexOf("once")?a="once":0===t.indexOf("on")&&(a="on"),this.bridge[v.bridge.method(t)||a](n,o,i)}else m.wechat?this[n]&&this[n](i):m.h5&&y.h5[y.h5[t]?t:"notSupport"](o,i,n,t);else p.push({key:n,callback:o,param:i})},register:function(e,n,o){var i=this,t=this;o&&(t=i[o]?i[o]:i[o]={}),w[e]=n,g[n]=e,t[e]=function(o){r(n,o,e)}}},o(y.share.wechat),o(y.share.hy),o(y.common),o(y.hy,"hy"),a(),c});